"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[6027],{94790:(e,t,a)=>{a.d(t,{f:()=>o});var r=a(68963),s=a(44920),n=a(75859);const o=e=>{let{children:t,content:a,className:o,pinOnClick:l,hasArrow:d=!0,placement:i=["top","bottom"],...u}=e;const[c,m]=r.useState(!1),[h,p]=r.useState(!1),g=r.useRef(null);return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(s.G,{anchorRef:g,open:h||c,placement:i,hasArrow:d,onOutsideClick:()=>{p(!1)},...u,children:a}),(0,n.jsx)("span",{className:o,ref:g,onClick:l?()=>{p(!0)}:void 0,onMouseEnter:()=>{m(!0)},onMouseLeave:()=>{m(!1)},children:t})]})}},36985:(e,t,a)=>{a.d(t,{C:()=>r.C});var r=a(49201)},68242:(e,t,a)=>{a.d(t,{m:()=>u});var r=a(24362),s=a(94790),n=a(27506),o=a(75859);const l=(0,r.cn)("ydb-pool-bar"),d=e=>{let{data:t={}}=e;const{Usage:a=0}=t,r=Math.min(100*a,100),d=(e=>e>=75?"danger":e>=50&&e<75?"warning":"normal")(r);return(0,o.jsx)(s.f,{className:l({type:d}),content:(0,o.jsx)(n.A8,{data:t,className:l("popup-content")}),children:(0,o.jsx)("div",{style:{height:`${r}%`},className:l("value",{type:d})})})},i=(0,r.cn)("ydb-pools-graph"),u=e=>{let{pools:t=[]}=e;return(0,o.jsx)("div",{className:i(),children:t.map(((e,t)=>(0,o.jsx)(d,{data:e},t)))})}},74221:(e,t,a)=>{a.d(t,{T:()=>o});var r=a(79734),s=a(80839),n=a(75859);const o=e=>{let{value:t,onChange:a,className:o}=e;return(0,n.jsxs)(r.E,{value:t,onUpdate:a,className:o,children:[(0,n.jsx)(r.E.Option,{value:s.pu.ALL,children:s.pu.ALL}),(0,n.jsx)(r.E.Option,{value:s.pu.PROBLEMS,children:s.pu.PROBLEMS})]})}},11551:(e,t,a)=>{a.d(t,{o:()=>r.o});var r=a(30629)},96027:(e,t,a)=>{a.d(t,{G:()=>k});var r=a(52317),s=a(17096),n=a(68963),o=a(81413),l=a(52846),d=a(36985),i=a(86969),u=a(1440),c=a(26688),m=a(56350),h=a(74221),p=a(2098),g=a(11551),v=a(47101),b=a(43989),N=a(3534),y=a(14223),x=a(80839),j=a(24362),w=a(51688),C=a(96939),P=a(30817);const L=JSON.parse('{"empty.default":"No such nodes"}'),S=JSON.parse('{"empty.default":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432"}'),f=(0,P.wZ)("ydb-nodes",{ru:S,en:L});var T=a(75859);const F=(0,j.cn)("ydb-nodes"),E=e=>{var t;let{path:a,database:j,additionalNodesProps:P={}}=e;const[L,S]=(0,l.useQueryParams)({uptimeFilter:l.StringParam,search:l.StringParam}),E=w.U8.parse(L.uptimeFilter),M=null!==(t=L.search)&&void 0!==t?t:"",A=(0,s.zL)(),I=(0,s.ix)(x.qz),[R]=(0,s.Rj)(),{currentData:U,isLoading:Z,error:k}=N.k.useGetNodesQuery({path:a,database:j},{pollingInterval:R}),[z,O]=n.useState({sortValue:"NodeId",sortOrder:o.zE}),[V,G]=(0,s.sC)(z,(e=>{O(e)})),D=e=>{S({search:e||void 0},"replaceIn")},W=e=>{A((0,x.M6)(e))},q=e=>{S({uptimeFilter:e},"replaceIn")},Q=n.useMemo((()=>(0,y.A)(null===U||void 0===U?void 0:U.Nodes,{searchValue:M,uptimeFilter:E,problemFilter:I})),[U,M,E,I]),H=(null===U||void 0===U?void 0:U.TotalNodes)||0;return(0,u.u)(k)?(0,T.jsx)(i.J,{}):(0,T.jsxs)(v.l,{children:[(0,T.jsx)(v.l.Controls,{children:(0,T.jsxs)(n.Fragment,{children:[(0,T.jsx)(g.o,{onChange:D,placeholder:"Host name",className:F("search"),value:M}),(0,T.jsx)(h.T,{value:I,onChange:W}),(0,T.jsx)(b.X,{value:E,onChange:q}),(0,T.jsx)(d.C,{total:H,current:Q.length,label:"Nodes",loading:Z})]})}),k?(0,T.jsx)(c.V,{error:k}):null,(0,T.jsx)(v.l.Table,{loading:Z,children:U?(()=>{const e=(0,C.gM)({getNodeRef:P.getNodeRef,database:j}).map((e=>({...e,sortable:(0,w.oh)(e.name)})));return 0!==Q.length||I===x.pu.ALL&&E===w.Uu.All?(0,T.jsx)(p.G,{columnsWidthLSKey:C.t5,data:Q||[],columns:e,settings:r.LE,sortOrder:V,onSort:G,emptyDataMessage:f("empty.default"),rowClassName:e=>F("node",{unavailable:(0,w.TA)(e)})}):(0,T.jsx)(m.Q,{name:"thumbsUp",width:"200"})})():null})]})};var M=a(11635),A=a(46925);const I=(e,t)=>`getNodes|offset${t}|limit${e}`,R=async e=>{const{type:t="any",storage:a=!1,tablets:r=!0,limit:s,offset:n,sortParams:o,filters:l}=e,{sortOrder:d,columnId:i}=null!==o&&void 0!==o?o:{},{path:u,database:c,searchValue:m,problemFilter:h,uptimeFilter:p}=null!==l&&void 0!==l?l:{},g=await window.api.getNodes({type:t,storage:a,tablets:r,limit:s,offset:n,sortOrder:d,sortValue:i,path:u,database:c,filter:m,problems_only:(0,w.eV)(h),uptime:(0,w.RW)(p)},{concurrentId:I(s,n),signal:e.signal}),v=(0,A.n)(g);return{data:v.Nodes||[],found:v.FoundNodes||0,total:v.TotalNodes||0}},U=(0,j.cn)("ydb-nodes"),Z=e=>{var t;let{path:a,database:r,parentContainer:o,additionalNodesProps:u}=e;const[p,v]=(0,l.useQueryParams)({uptimeFilter:l.StringParam,search:l.StringParam}),N=w.U8.parse(p.uptimeFilter),y=null!==(t=p.search)&&void 0!==t?t:"",j=(0,s.zL)(),P=(0,s.ix)(x.qz),L=n.useMemo((()=>({path:a,database:r,searchValue:y,problemFilter:P,uptimeFilter:N})),[a,r,y,P,N]),S=(0,C.gM)({getNodeRef:null===u||void 0===u?void 0:u.getNodeRef,database:r}).map((e=>({...e,sortable:(0,w.oh)(e.name)})));return(0,T.jsx)(M.WQ,{columnsWidthLSKey:C.t5,parentContainer:o,columns:S,fetchData:R,limit:50,renderControls:e=>{let{totalEntities:t,foundEntities:a,inited:r}=e;return(0,T.jsxs)(n.Fragment,{children:[(0,T.jsx)(g.o,{onChange:e=>{v({search:e||void 0},"replaceIn")},placeholder:"Host name",className:U("search"),value:y}),(0,T.jsx)(h.T,{value:P,onChange:e=>{j((0,x.M6)(e))}}),(0,T.jsx)(b.X,{value:N,onChange:e=>{v({uptimeFilter:e},"replaceIn")}}),(0,T.jsx)(d.C,{total:t,current:a,label:"Nodes",loading:!r})]})},renderErrorMessage:e=>e&&403===e.status?(0,T.jsx)(i.J,{position:"left"}):(0,T.jsx)(c.V,{error:e}),renderEmptyDataMessage:()=>P!==x.pu.ALL||N!==w.Uu.All?(0,T.jsx)(m.Q,{name:"thumbsUp",width:"200"}):f("empty.default"),getRowClassName:e=>U("node",{unavailable:(0,w.TA)(e)}),filters:L,tableName:"nodes"})},k=e=>{let{parentContainer:t,...a}=e;const[n]=(0,s.yu)(r.Qy);return n?(0,T.jsx)(Z,{parentContainer:t,...a}):(0,T.jsx)(E,{...a})}},96939:(e,t,a)=>{a.d(t,{t5:()=>x,gM:()=>B,LF:()=>X,sQ:()=>J,Cj:()=>K});var r=a(19812),s=a(99683),n=a(89778),o=a(68242),l=a(67359),d=a(83203),i=a(92398),u=a(54665),c=a(24362),m=a(52317),h=a(83496),p=a(75859);const g=(0,c.cn)("tablets-statistic"),v=e=>{let{tablets:t=[],path:a,nodeId:r,backend:s}=e;const n=(e=>e.map((e=>({label:(0,m.qV)(e.Type),type:e.Type,count:e.Count,state:(0,h.FW)(e.State)}))).sort(((e,t)=>String(e.label).localeCompare(String(t.label)))))(t);return(0,p.jsx)("div",{className:g(),children:n.map(((e,t)=>{var n;const o=(0,u.ax)(u.ZP.node,{id:r,activeTab:i.IA},{tenantName:a,backend:s}),l=`${e.label}: ${e.count}`,c=g("tablet",{state:null===(n=e.state)||void 0===n?void 0:n.toLowerCase()});return s?(0,p.jsx)("a",{href:o,className:c,children:l},t):(0,p.jsx)(d.rU,{to:o,className:c,children:l},t)}))})};var b=a(80816),N=a(46925),y=a(34301);const x="nodesTableColumnsWidth",j="Host",w="DC",C="Rack",P="Version",L="Uptime",S="Memory",f="CPU",T="LoadAverage",F="Tablets",E="TopNodesLoadAverage",M="TopNodesMemory",A="SharedCacheUsage",I="TotalSessions",R={name:"NodeId",header:"#",width:80,render:e=>{let{row:t}=e;return t.NodeId},align:r.ZP.RIGHT,sortable:!1},U=(e,t)=>({name:j,render:a=>{let{row:r}=a;return(0,p.jsx)(n.k,{node:r,getNodeRef:e,database:t})},width:350,align:r.ZP.LEFT,sortable:!1}),Z=e=>({...U(e),width:void 0}),k={name:w,header:"DC",align:r.ZP.LEFT,render:e=>{let{row:t}=e;return t.DC||m.jX},width:60},z={name:C,header:"Rack",align:r.ZP.LEFT,render:e=>{let{row:t}=e;return t.Rack?t.Rack:"\u2014"},width:80},O={name:P,width:200,align:r.ZP.LEFT,render:e=>{let{row:t}=e;return(0,p.jsx)(s.l,{content:t.Version,children:t.Version})},sortable:!1},V={name:L,header:"Uptime",sortAccessor:e=>{let{StartTime:t}=e;return t&&-t},render:e=>{let{row:t}=e;return t.Uptime},align:r.ZP.RIGHT,width:110,sortable:!1},G={name:S,header:"Memory",sortAccessor:e=>{let{MemoryUsed:t=0}=e;return Number(t)},defaultOrder:r.ZP.DESCENDING,render:e=>{let{row:t}=e;return(0,p.jsx)(l.y,{value:t.MemoryUsed,capacity:t.MemoryLimit,formatValues:y.q3,colorizeProgress:!0})},align:r.ZP.RIGHT,width:120},D={name:f,header:"CPU",sortAccessor:e=>{let{PoolStats:t=[]}=e;return Math.max(...t.map((e=>{let{Usage:t}=e;return Number(t)})))},defaultOrder:r.ZP.DESCENDING,render:e=>{let{row:t}=e;return t.PoolStats?(0,p.jsx)(o.m,{pools:t.PoolStats}):"\u2014"},align:r.ZP.LEFT,width:80,resizeMinWidth:60,sortable:!1},W={name:T,header:"Load average",sortAccessor:e=>{let{LoadAveragePercents:t=[]}=e;return t[0]},defaultOrder:r.ZP.DESCENDING,render:e=>{let{row:t}=e;return(0,p.jsx)(l.y,{value:t.LoadAveragePercents&&t.LoadAveragePercents.length>0?t.LoadAveragePercents[0]:void 0,percents:!0,colorizeProgress:!0,capacity:100})},align:r.ZP.LEFT,width:140,resizeMinWidth:140,sortable:!1},q=e=>({name:F,width:500,resizeMinWidth:500,render:t=>{let{row:a}=t;return a.Tablets?(0,p.jsx)(v,{path:null!==e&&void 0!==e?e:a.TenantName,nodeId:a.NodeId,tablets:a.Tablets}):"\u2014"},align:r.ZP.LEFT,sortable:!1}),Q={name:E,header:"Load",render:e=>{let{row:t}=e;return t.LoadAveragePercents&&t.LoadAveragePercents.length>0?(0,p.jsx)(b.a,{value:t.LoadAveragePercents[0].toFixed(),theme:(0,N.w)(t.LoadAveragePercents[0])}):"\u2014"},align:r.ZP.LEFT,width:80,resizeMinWidth:70,sortable:!1},H={name:M,header:"Process",render:e=>{let{row:t}=e;return(0,p.jsx)(l.y,{value:t.MemoryUsed,capacity:t.MemoryLimit,formatValues:y.q3,colorizeProgress:!0})},align:r.ZP.LEFT,width:140,resizeMinWidth:140,sortable:!1},$={name:A,header:"Caches",render:e=>{let{row:t}=e;return(0,p.jsx)(l.y,{value:t.SharedCacheUsed,capacity:t.SharedCacheLimit,formatValues:y.q3,colorizeProgress:!0})},align:r.ZP.LEFT,width:140,resizeMinWidth:140,sortable:!1},_={name:I,header:"Sessions",render:e=>{var t;let{row:a}=e;return null!==(t=a.TotalSessions)&&void 0!==t?t:"\u2014"},align:r.ZP.RIGHT,width:100,sortable:!1};function B(e){let{database:t,getNodeRef:a}=e;return[R,U(a,t),k,z,O,V,G,D,W,q(t)]}function J(e){return[Q,R,Z(e),O]}function X(e){return[D,R,Z(e)]}function K(e){let{database:t,getNodeRef:a}=e;return[R,U(a,t),V,Q,H,$,_,q(t)]}},3534:(e,t,a)=>{a.d(t,{k:()=>n});var r=a(905),s=a(46925);const n=r.h.injectEndpoints({endpoints:e=>({getNodes:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await window.api.getNodes({type:"any",storage:!1,tablets:!0,...e},{signal:a});return{data:(0,s.n)(t)}}catch(r){return{error:r}}},providesTags:["All"]})}),overrideExisting:"throw"})},46925:(e,t,a)=>{a.d(t,{n:()=>n,w:()=>o});var r=a(99106),s=a(51688);const n=e=>{var t;const a=(e.Nodes||[]).map((e=>{var t,a,r,n;const o=Number(null===(t=e.SystemState.SharedCacheStats)||void 0===t?void 0:t.LimitBytes)||void 0;return{...(0,s.Ns)(e.SystemState),Tablets:e.Tablets,NodeId:e.NodeId,TenantName:null===(a=e.SystemState)||void 0===a||null===(r=a.Tenants)||void 0===r?void 0:r[0],SharedCacheUsed:null===(n=e.SystemState.SharedCacheStats)||void 0===n?void 0:n.UsedBytes,SharedCacheLimit:o}}));return{Nodes:a,NodeGroups:null===(t=e.NodeGroups)||void 0===t?void 0:t.map((e=>({name:e.GroupName,count:e.NodeCount}))),TotalNodes:Number(e.TotalNodes)||a.length,FoundNodes:Number(e.FoundNodes)}},o=(0,r.p)(60,80,["success","warning","danger"])}}]);