"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[4597],{65070:(e,t,s)=>{s.d(t,{U:()=>r});var i=s(68963),n=s(17176),o=s(68330),a=s(86793),l=s(45743),d=s(75859);function r(e){let{children:t,onConfirmAction:s,onConfirmActionSuccess:r,dialogHeader:u,dialogText:c,retryButtonText:v,buttonDisabled:p=!1,buttonView:h="action",buttonClassName:k,withPopover:D=!1,popoverContent:g,popoverPlacement:b="right",popoverDisabled:m=!0}=e;const[x,y]=i.useState(!1),[f,j]=i.useState(!1),[I,N]=i.useState(!1),w=()=>(0,d.jsx)(n.z,{onClick:()=>y(!0),view:h,disabled:p,loading:!p&&f,className:k,children:t});return(0,d.jsxs)(i.Fragment,{children:[(0,d.jsx)(a.g,{visible:x,header:u,text:c,withRetry:I,retryButtonText:v,onConfirm:async e=>{j(!0),await s(e)},onConfirmActionSuccess:async()=>{N(!1);try{await(null===r||void 0===r?void 0:r())}finally{j(!1)}},onConfirmActionError:e=>{N((0,l.q)(e)),j(!1)},onClose:()=>{y(!1)}}),D?(0,d.jsx)(o.J,{content:g,placement:b,disabled:m,children:w()}):w()]})}},86793:(e,t,s)=>{s.d(t,{g:()=>D});var i=s(68963),n=s(76506),o=s(71586),a=s(48897),l=s(25822),d=s(88776),r=s(24362),u=s(30817);const c=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-retry":"Retry","button-cancel":"Cancel","button-close":"Close","checkbox-text":"I understand what I\'m doing"}'),v=(0,u.wZ)("ydb-critical-action-dialog",{en:c});var p=s(75859);const h=(0,r.cn)("ydb-critical-dialog"),k=e=>403===e.status?v("no-rights-error"):e.statusText?e.statusText:v("default-error");function D(e){let{visible:t,header:s,text:r,withRetry:u,retryButtonText:c,withCheckBox:D,onClose:g,onConfirm:b,onConfirmActionSuccess:m,onConfirmActionError:x}=e;const[y,f]=i.useState(!1),[j,I]=i.useState(),[N,w]=i.useState(!1),S=async e=>(f(!0),b(e).then((()=>{m(),g()})).catch((e=>{x(e),I(e)})).finally((()=>{f(!1)})));return(0,p.jsx)(l.V,{open:t,hasCloseButton:!1,className:h(),size:"s",onClose:g,onTransitionExited:()=>{I(void 0),w(!1)},children:j?(0,p.jsxs)(i.Fragment,{children:[(0,p.jsx)(l.V.Header,{caption:s}),(0,p.jsx)(l.V.Body,{className:h("body"),children:(0,p.jsxs)("div",{className:h("body-message",{error:!0}),children:[(0,p.jsx)("span",{className:h("error-icon"),children:(0,p.jsx)(n.Z,{width:"24",height:"22"})}),k(j)]})}),(0,p.jsx)(l.V.Footer,{loading:!1,preset:"default",textButtonApply:u?c||v("button-retry"):void 0,textButtonCancel:v("button-close"),onClickButtonApply:()=>S(!0),onClickButtonCancel:g})]}):(0,p.jsxs)(i.Fragment,{children:[(0,p.jsx)(l.V.Header,{caption:s}),(0,p.jsxs)(l.V.Body,{className:h("body"),children:[(0,p.jsxs)("div",{className:h("body-message",{warning:!0}),children:[(0,p.jsx)("span",{className:h("warning-icon"),children:(0,p.jsx)(d.J,{data:o.Z,size:24})}),r]}),D?(0,p.jsx)(a.X,{checked:N,onUpdate:w,children:v("checkbox-text")}):null]}),(0,p.jsx)(l.V.Footer,{loading:y,preset:"default",textButtonApply:v("button-confirm"),textButtonCancel:v("button-cancel"),propsButtonApply:{type:"submit",disabled:D&&!N},onClickButtonCancel:g,onClickButtonApply:()=>S()})]})})}},45743:(e,t,s)=>{s.d(t,{q:()=>i});const i=e=>Boolean(e&&"object"===typeof e&&"retryPossible"in e&&e.retryPossible)},30832:(e,t,s)=>{s.d(t,{a:()=>l});var i=s(24362),n=s(98366),o=s(75859);const a=(0,i.cn)("ydb-entity-page-title");function l(e){let{entityName:t,status:s,id:i,className:l}=e;return(0,o.jsxs)("div",{className:a(null,l),children:[(0,o.jsx)("span",{className:a("prefix"),children:t}),(0,o.jsx)(n.J,{className:a("icon"),status:s,size:"s"}),i]})}},91816:(e,t,s)=>{s.d(t,{b:()=>u});var i=s(68963),n=s(56711),o=s(24362),a=s(42587),l=s(75859);const d=(0,o.cn)("ydb-info-viewer-skeleton"),r=()=>(0,l.jsxs)("div",{className:d("label"),children:[(0,l.jsx)(n.O,{className:d("label__text")}),(0,l.jsx)("div",{className:d("label__dots")})]}),u=e=>{let{rows:t=8,className:s,delay:o=600}=e;const[u]=(0,a.$)(o);let c=(0,l.jsxs)(i.Fragment,{children:[(0,l.jsx)(r,{}),(0,l.jsx)(n.O,{className:d("value")})]});return u||(c=null),(0,l.jsx)("div",{className:d(null,s),children:[...new Array(t)].map(((e,t)=>(0,l.jsx)("div",{className:d("row"),children:c},`skeleton-row-${t}`)))})}},27174:(e,t,s)=>{s.d(t,{B:()=>v});var i=s(77796),n=s(24362),o=s(50422),a=s(56711),l=s(42587),d=s(75859);const r=e=>{let{delay:t=600,className:s}=e;const[i]=(0,l.$)(t);return i?(0,d.jsx)(a.O,{className:s}):null},u=(0,n.cn)("ydb-page-meta");function c(e){let{items:t,loading:s}=e;return(0,d.jsx)("div",{className:u("info"),children:s?(0,d.jsx)(r,{className:u("skeleton")}):t.filter((e=>Boolean(e))).join("\xa0\xa0\xb7\xa0\xa0")})}function v(e){let{className:t,...s}=e;return(0,d.jsxs)(i.k,{gap:1,alignItems:"center",justifyContent:"space-between",className:u(null,t),children:[(0,d.jsx)(c,{...s}),(0,d.jsx)(o.q,{})]})}},22200:(e,t,s)=>{s.d(t,{K:()=>f});s(68963);var i=s(54665),n=s(14146),o=s(17880),a=s(5922),l=s(24362),d=s(34301),r=s(48169),u=s(92666),c=s(17096),v=s(55850),p=s(69214),h=s(62206),k=s(32270),D=s(67359),g=s(30817);const b=JSON.parse('{"slot-id":"VDisk Slot Id","pool-name":"Storage Pool Name","kind":"Kind","guid":"GUID","incarnation-guid":"Incarnation GUID","instance-guid":"Instance GUID","replication-status":"Replicated","state-status":"VDisk State","space-status":"Disk Space","fresh-rank-satisfaction":"Fresh Rank Satisfaction","level-rank-satisfaction":"Level Rank Satisfaction","front-queues":"Front Queues","has-unreadable-blobs":"Has Unreadable Blobs","size":"Size","read-throughput":"Read Throughput","write-throughput":"Write Throughput","links":"Links","vdisk-page":"VDisk Page","developer-ui":"Developer UI","yes":"Yes","no":"No","vdiks-title":"VDisk"}'),m=(0,g.wZ)("ydb-vDisk-info",{en:b});var x=s(75859);const y=(0,l.cn)("ydb-vdisk-info");function f(e){var t,s;let{data:l,withVDiskPageLink:u,withTitle:g,...b}=e;const f=(0,o.X_)(),I=(0,c.ix)(n.VH),{AllocatedSize:N,DiskSpace:w,FrontQueues:S,Guid:V,Replicated:C,VDiskState:P,VDiskSlotId:B,Kind:T,SatisfactionRank:A,AvailableSize:F,HasUnreadableBlobs:R,IncarnationGuid:$,InstanceGuid:G,StoragePoolName:H,ReadThroughput:q,WriteThroughput:z,PDiskId:U,NodeId:E}=l||{},_=[];var J,L;((0,a.D)(B)&&_.push({label:m("slot-id"),value:B}),(0,a.D)(H)&&_.push({label:m("pool-name"),value:H}),(0,a.D)(P)&&_.push({label:m("state-status"),value:P}),Number(N)>=0&&Number(F)>=0&&_.push({label:m("size"),value:(0,x.jsx)(D.y,{value:N,capacity:Number(N)+Number(F),formatValues:d.q3,colorizeProgress:!0})}),(0,a.D)(T)&&_.push({label:m("kind"),value:T}),(0,a.D)(V)&&_.push({label:m("guid"),value:V}),(0,a.D)($)&&_.push({label:m("incarnation-guid"),value:$}),(0,a.D)(G)&&_.push({label:m("instance-guid"),value:G}),(0,a.D)(C)&&_.push({label:m("replication-status"),value:m(C?"yes":"no")}),(0,a.D)(w)&&_.push({label:m("space-status"),value:(0,x.jsx)(p.A,{status:w})}),(0,a.D)(null===A||void 0===A||null===(t=A.FreshRank)||void 0===t?void 0:t.Flag))&&_.push({label:m("fresh-rank-satisfaction"),value:(0,x.jsx)(p.A,{status:null===A||void 0===A||null===(J=A.FreshRank)||void 0===J?void 0:J.Flag})});(0,a.D)(null===A||void 0===A||null===(s=A.LevelRank)||void 0===s?void 0:s.Flag)&&_.push({label:m("level-rank-satisfaction"),value:(0,x.jsx)(p.A,{status:null===A||void 0===A||null===(L=A.LevelRank)||void 0===L?void 0:L.Flag})});(0,a.D)(S)&&_.push({label:m("front-queues"),value:(0,x.jsx)(p.A,{status:S})}),(0,a.D)(R)&&_.push({label:m("has-unreadable-blobs"),value:m(R?"yes":"no")}),(0,a.D)(q)&&_.push({label:m("read-throughput"),value:(0,v.Qt)(q)}),(0,a.D)(z)&&_.push({label:m("write-throughput"),value:(0,v.Qt)(z)});if((0,a.D)(U)&&(0,a.D)(E)&&(0,a.D)(B)){const e=[];if(u&&f){const t=(0,i.By)(B,U,E);e.push((0,x.jsx)(k.j,{title:m("vdisk-page"),url:t,external:!1},t))}if(I){const t=(0,r.yf)({nodeId:E,pDiskId:U,vDiskSlotId:B});e.push((0,x.jsx)(k.j,{title:m("developer-ui"),url:t},t))}e.length&&_.push({label:m("links"),value:(0,x.jsx)("div",{className:y("links"),children:e})})}const Q=l&&g?(0,x.jsx)(j,{data:l}):null;return(0,x.jsx)(h._P,{info:_,title:Q,...b})}function j(e){let{data:t}=e;return(0,x.jsxs)("div",{className:y("title"),children:[m("vdiks-title"),(0,x.jsx)(p.A,{status:(0,u.b2)(t.Severity),name:(0,d.a2)(t.VDiskId)})]})}},54597:(e,t,s)=>{s.r(t),s.d(t,{VDiskGroup:()=>H,VDiskPage:()=>G});var i=s(68963),n=s(42154),o=s(88776),a=s(17095),l=s(49352),d=s(52846),r=s(65070),u=s(30832),c=s(26688),v=s(91816),p=s(27174),h=s(2098),k=s(22200),D=s(905),g=s(14146),b=s(17880),m=s(79061),x=s(33058),y=s(92666),f=s(3764),j=s(51688);const I=D.h.injectEndpoints({endpoints:e=>({getVDiskData:e.query({queryFn:async(e,t)=>{let{nodeId:s,pDiskId:i,vDiskSlotId:n}=e,{signal:o}=t;try{const e=function(e){var t,s,i,n,o,a,l;let[d,r,u]=e;const c=null===(t=d.VDiskStateInfo)||void 0===t?void 0:t[0],v=(0,f.w)(c),p=null===(s=r.PDiskStateInfo)||void 0===s?void 0:s[0],h=(0,f.b)(p),k=null===(i=u.SystemStateInfo)||void 0===i?void 0:i[0],D=(0,j.Ns)(k),g=null!==(n=null!==(o=v.NodeId)&&void 0!==o?o:h.NodeId)&&void 0!==n?n:D.NodeId,b=D.Host,m=null===(a=D.Roles)||void 0===a?void 0:a[0],x=D.DC,y=null!==(l=v.PDiskId)&&void 0!==l?l:h.PDiskId,I=h.Type;return{...v,NodeId:g,NodeHost:b,NodeType:m,NodeDC:x,PDiskId:y,PDiskType:I}}(await Promise.all([window.api.getVDiskInfo({nodeId:s,pDiskId:i,vDiskSlotId:n},{signal:o}),window.api.getNodeWhiteboardPDiskInfo({nodeId:s,pDiskId:i},{signal:o}),window.api.getNodeInfo(s,{signal:o})]));return{data:e}}catch(a){return{error:a}}},providesTags:(e,t,s)=>["All",{type:"VDiskData",id:(0,y.FR)(s.nodeId,s.pDiskId,s.vDiskSlotId)}]})}),overrideExisting:"throw"});var N=s(5922),w=s(24362),S=s(52317),V=s(34301),C=s(17096),P=s(77382),B=s(46393),T=s(30817);const A=JSON.parse('{"fqdn":"FQDN","node":"Node","pdisk":"PDisk","vdisk":"VDisk","group":"Group","evict-vdisk-button":"Evict VDisk","force-evict-vdisk-button":"Evict anyway","evict-vdisk-dialog-header":"Evict VDisk","evict-vdisk-dialog-text":"VDisk will be evicted. Do you want to proceed?","evict-vdisk-not-allowed":"You don\'t have enough rights to evict VDisk"}'),F=(0,T.wZ)("ydb-vDisk-page",{en:A});var R=s(75859);const $=(0,w.cn)("ydb-vdisk-page");function G(){const e=(0,C.zL)(),t=(0,C.ix)(g.VH),[{nodeId:s,pDiskId:h,vDiskSlotId:b}]=(0,d.useQueryParams)({nodeId:d.StringParam,pDiskId:d.StringParam,vDiskSlotId:d.StringParam});i.useEffect((()=>{e((0,m.J)("vDisk",{nodeId:s,pDiskId:h,vDiskSlotId:b}))}),[e,s,h,b]);const[x]=(0,C.Rj)(),f=(0,N.D)(s)&&(0,N.D)(h)&&(0,N.D)(b)?{nodeId:s,pDiskId:h,vDiskSlotId:b}:a.CN,{currentData:j={},isFetching:w,error:S}=I.useGetVDiskDataQuery(f,{pollingInterval:x}),P=w&&void 0===j,{NodeHost:B,NodeId:T,NodeType:A,NodeDC:G,PDiskId:q,PDiskType:z,Severity:U,VDiskId:E}=j,{GroupID:_,GroupGeneration:J,Ring:L,Domain:Q,VDisk:O}=E||{},Z=(0,N.D)(_)&&(0,N.D)(J)&&(0,N.D)(L)&&(0,N.D)(Q)&&(0,N.D)(O),K=async e=>{if(Z)return window.api.evictVDisk({groupId:_,groupGeneration:J,failRealmIdx:L,failDomainIdx:Q,vDiskIdx:O,force:e}).then((e=>{if(!1===(null===e||void 0===e?void 0:e.result)){throw{statusText:e.error,retryPossible:e.forceRetryPossible}}}))},Y=()=>{e(D.h.util.invalidateTags([{type:"VDiskData",id:(0,y.FR)(s||0,h||0,b||0)},"StorageData"]))};return(0,R.jsxs)("div",{className:$(null),children:[(()=>{const e=b?`${F("vdisk")} ${b}`:F("vdisk"),t=h?`${F("pdisk")} ${h}`:F("pdisk"),s=B||F("node");return(0,R.jsx)(l.ql,{titleTemplate:`%s - ${e} - ${t} \u2014 ${s} \u2014 YDB Monitoring`,defaultTitle:`${e} - ${t} \u2014 ${s} \u2014 YDB Monitoring`})})(),(()=>{const e=B?`${F("fqdn")}: ${B}`:void 0,t=T?`${F("node")}: ${T}`:void 0,s=T?`${F("pdisk")}: ${q}`:void 0;return(0,R.jsx)(p.B,{className:$("meta"),loading:P,items:[e,t,A,G,s,z]})})(),(0,R.jsx)(u.a,{className:$("title"),entityName:F("vdisk"),status:(0,y.b2)(U),id:(0,V.a2)(null===j||void 0===j?void 0:j.VDiskId)}),(0,R.jsx)("div",{className:$("controls"),children:(0,R.jsxs)(r.U,{onConfirmAction:K,onConfirmActionSuccess:Y,buttonDisabled:!Z||!t,buttonView:"normal",dialogHeader:F("evict-vdisk-dialog-header"),dialogText:F("evict-vdisk-dialog-text"),retryButtonText:F("force-evict-vdisk-button"),withPopover:!0,popoverContent:F("evict-vdisk-not-allowed"),popoverDisabled:t,children:[(0,R.jsx)(o.J,{data:n.Z}),F("evict-vdisk-button")]})}),P?(0,R.jsx)(v.b,{rows:20}):(0,R.jsxs)(i.Fragment,{children:[S?(0,R.jsx)(c.V,{error:S}):null,(0,R.jsx)(k.K,{data:j,className:$("info")}),(0,N.D)(_)?(0,R.jsx)(H,{groupId:_}):null]})]})}function H(e){let{groupId:t}=e;const s=(0,b.rU)(),n=(0,b.tS)(),[o]=(0,C.Rj)(),{currentData:a}=x.y.useGetStorageGroupsInfoQuery({groupId:t,shouldUseGroupsHandler:n},{pollingInterval:o,skip:!s}),l=i.useMemo((()=>{const e=function(e,t){var s;return null===e||void 0===e||null===(s=e.groups)||void 0===s?void 0:s.find((e=>Number(e.GroupId)===Number(t)))}(a,t);return e?[e]:void 0}),[a,t]),d=(0,B.M)();return l?(0,R.jsxs)(i.Fragment,{children:[(0,R.jsx)("div",{className:$("group-title"),children:F("group")}),(0,R.jsx)(h.G,{columnsWidthLSKey:P.Ty,data:l,columns:d,settings:S.LE})]}):null}}}]);