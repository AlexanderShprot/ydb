"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[3578],{65070:(e,t,a)=>{a.d(t,{U:()=>d});var n=a(68963),r=a(17176),o=a(68330),s=a(86793),l=a(45743),i=a(75859);function d(e){let{children:t,onConfirmAction:a,onConfirmActionSuccess:d,dialogHeader:c,dialogText:u,retryButtonText:v,buttonDisabled:h=!1,buttonView:p="action",buttonClassName:m,withPopover:b=!1,popoverContent:g,popoverPlacement:x="right",popoverDisabled:y=!0}=e;const[j,N]=n.useState(!1),[T,w]=n.useState(!1),[f,I]=n.useState(!1),S=()=>(0,i.jsx)(r.z,{onClick:()=>N(!0),view:p,disabled:h,loading:!h&&T,className:m,children:t});return(0,i.jsxs)(n.Fragment,{children:[(0,i.jsx)(s.g,{visible:j,header:c,text:u,withRetry:f,retryButtonText:v,onConfirm:async e=>{w(!0),await a(e)},onConfirmActionSuccess:async()=>{I(!1);try{await(null===d||void 0===d?void 0:d())}finally{w(!1)}},onConfirmActionError:e=>{I((0,l.q)(e)),w(!1)},onClose:()=>{N(!1)}}),b?(0,i.jsx)(o.J,{content:g,placement:x,disabled:y,children:S()}):S()]})}},86793:(e,t,a)=>{a.d(t,{g:()=>b});var n=a(68963),r=a(76506),o=a(71586),s=a(48897),l=a(25822),i=a(88776),d=a(24362),c=a(30817);const u=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-retry":"Retry","button-cancel":"Cancel","button-close":"Close","checkbox-text":"I understand what I\'m doing"}'),v=(0,c.wZ)("ydb-critical-action-dialog",{en:u});var h=a(75859);const p=(0,d.cn)("ydb-critical-dialog"),m=e=>403===e.status?v("no-rights-error"):e.statusText?e.statusText:v("default-error");function b(e){let{visible:t,header:a,text:d,withRetry:c,retryButtonText:u,withCheckBox:b,onClose:g,onConfirm:x,onConfirmActionSuccess:y,onConfirmActionError:j}=e;const[N,T]=n.useState(!1),[w,f]=n.useState(),[I,S]=n.useState(!1),C=async e=>(T(!0),x(e).then((()=>{y(),g()})).catch((e=>{j(e),f(e)})).finally((()=>{T(!1)})));return(0,h.jsx)(l.V,{open:t,hasCloseButton:!1,className:p(),size:"s",onClose:g,onTransitionExited:()=>{f(void 0),S(!1)},children:w?(0,h.jsxs)(n.Fragment,{children:[(0,h.jsx)(l.V.Header,{caption:a}),(0,h.jsx)(l.V.Body,{className:p("body"),children:(0,h.jsxs)("div",{className:p("body-message",{error:!0}),children:[(0,h.jsx)("span",{className:p("error-icon"),children:(0,h.jsx)(r.Z,{width:"24",height:"22"})}),m(w)]})}),(0,h.jsx)(l.V.Footer,{loading:!1,preset:"default",textButtonApply:c?u||v("button-retry"):void 0,textButtonCancel:v("button-close"),onClickButtonApply:()=>C(!0),onClickButtonCancel:g})]}):(0,h.jsxs)(n.Fragment,{children:[(0,h.jsx)(l.V.Header,{caption:a}),(0,h.jsxs)(l.V.Body,{className:p("body"),children:[(0,h.jsxs)("div",{className:p("body-message",{warning:!0}),children:[(0,h.jsx)("span",{className:p("warning-icon"),children:(0,h.jsx)(i.J,{data:o.Z,size:24})}),d]}),b?(0,h.jsx)(s.X,{checked:I,onUpdate:S,children:v("checkbox-text")}):null]}),(0,h.jsx)(l.V.Footer,{loading:N,preset:"default",textButtonApply:v("button-confirm"),textButtonCancel:v("button-cancel"),propsButtonApply:{type:"submit",disabled:b&&!I},onClickButtonCancel:g,onClickButtonApply:()=>C()})]})})}},45743:(e,t,a)=>{a.d(t,{q:()=>n});const n=e=>Boolean(e&&"object"===typeof e&&"retryPossible"in e&&e.retryPossible)},97482:(e,t,a)=>{a.d(t,{f:()=>s});var n=a(14979),r=a(83496),o=a(75859);function s(e){let{state:t}=e;return(0,o.jsx)(n._,{theme:(0,r.KR)(t),children:t})}},12199:(e,t,a)=>{a.d(t,{$:()=>i});a(68963);var n=a(24362),r=a(75859);const o=(0,n.cn)("tag"),s=e=>{let{text:t,type:a}=e;return(0,r.jsx)("div",{className:o({type:a}),children:t})},l=(0,n.cn)("tags"),i=e=>{let{tags:t,tagsType:a,className:n=""}=e;return(0,r.jsx)("div",{className:l(null,n),children:t&&t.map(((e,t)=>(0,r.jsx)(s,{text:e,type:a},t)))})}},3977:(e,t,a)=>{a.r(t),a.d(t,{Node:()=>E,STORAGE_ROLE:()=>V});var n=a(68963),r=a(8179),o=a(49352),s=a(86974),l=a(83203),i=a(50422),d=a(39683),c=a(88776),u=a(24362),v=a(48169),h=a(69214),p=a(12199),m=a(75859);const b=(0,u.cn)("basic-node-viewer"),g=e=>{let t,{node:a,additionalNodesProps:r,className:o}=e;return null!==r&&void 0!==r&&r.getNodeRef?t=r.getNodeRef(a)+"internal":a.NodeId&&(t=(0,v.wq)(a.NodeId)+"internal"),(0,m.jsx)("div",{className:b(null,o),children:a?(0,m.jsxs)(n.Fragment,{children:[(0,m.jsx)("div",{className:b("title"),children:"Node"}),(0,m.jsx)(h.A,{status:a.SystemState,name:a.Host}),t&&(0,m.jsx)("a",{rel:"noopener noreferrer",className:b("link",{external:!0}),href:t,target:"_blank",children:(0,m.jsx)(c.J,{data:d.Z})}),(0,m.jsxs)("div",{className:b("id"),children:[(0,m.jsx)("label",{className:b("label"),children:"NodeID"}),(0,m.jsx)("label",{children:a.NodeId})]}),a.DC&&(0,m.jsx)(p.$,{tags:[a.DC]}),a.Roles&&(0,m.jsx)(p.$,{tags:a.Roles,tagsType:"blue"})]}):(0,m.jsx)("div",{className:"error",children:"no data"})})};var x=a(26688),y=a(52317),j=a(23373);const N=(0,u.cn)("ydb-pool-usage"),T=e=>{let t="green";return e>60&&e<=80?t="yellow":e>80&&(t="red"),t},w=e=>{let{data:t={}}=e;const{Threads:a,Name:n="Unknown",Usage:r=0}=t,o=r&&a,s=Math.floor(100*r),l=s>100?100:s;return(0,m.jsxs)("div",{className:N(),children:[(0,m.jsxs)("div",{className:N("info"),children:[(0,m.jsx)("div",{className:N("pool-name"),children:n}),o&&(0,m.jsxs)("div",{className:N("value"),children:[(0,m.jsxs)("div",{className:N("percents"),children:[s<1?"<1":s,"%"]}),(0,m.jsxs)("div",{className:N("threads"),children:["(\xd7",a,")"]})]})]}),(0,m.jsx)("div",{className:N("visual"),children:(0,m.jsx)("div",{className:N("usage-line",{type:T(l)}),style:{width:`${l}%`}})})]})};var f=a(67359);const I=(0,u.cn)("full-node-viewer"),S=e=>{var t,a,n,r;let{node:o,className:s}=e;const l=null===o||void 0===o||null===(t=o.Endpoints)||void 0===t?void 0:t.map((e=>{let{Name:t,Address:a}=e;return{label:t,value:a}})),i=[];null!==o&&void 0!==o&&null!==(a=o.Tenants)&&void 0!==a&&a.length&&i.push({label:"Database",value:o.Tenants[0]}),i.push({label:"Version",value:null===o||void 0===o?void 0:o.Version},{label:"Uptime",value:null===o||void 0===o?void 0:o.Uptime},{label:"DC",value:(null===o||void 0===o?void 0:o.DataCenterDescription)||(null===o||void 0===o?void 0:o.DC)},{label:"Rack",value:null===o||void 0===o?void 0:o.Rack});const d=null===o||void 0===o||null===(n=o.LoadAveragePercents)||void 0===n?void 0:n.map(((e,t)=>({label:y.x5[t],value:(0,m.jsx)(f.y,{value:e,percents:!0,colorizeProgress:!0,capacity:100})})));return(0,m.jsx)("div",{className:`${I()} ${s}`,children:o?(0,m.jsxs)("div",{className:I("common-info"),children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:I("section-title"),children:"Pools"}),(0,m.jsx)("div",{className:I("section",{pools:!0}),children:null===o||void 0===o||null===(r=o.PoolStats)||void 0===r?void 0:r.map(((e,t)=>(0,m.jsx)(w,{data:e},t)))})]}),l&&l.length&&(0,m.jsx)(j._,{title:"Endpoints",className:I("section"),info:l}),(0,m.jsx)(j._,{title:"Common info",className:I("section"),info:i}),(0,m.jsx)(j._,{title:"Load average",className:I("section",{average:!0}),info:d})]}):(0,m.jsx)("div",{className:"error",children:"no data"})})};var C=a(62776),D=a(54665),k=a(79061),A=a(71698),q=a(17096),P=a(19897),B=a(42635),F=a(92398);const R=(0,u.cn)("node"),V="Storage";function E(e){var t,a;const d=n.useRef(null),c=(0,q.zL)(),u=(0,s.TH)(),v=null!==(t=(0,s.$B)(D.ZP.node))&&void 0!==t?t:Object.create(null),{id:h,activeTab:p}=v.params,{tenantName:b}=(0,D.mB)(u),[y]=(0,q.Rj)(),{currentData:j,isFetching:N,error:T}=A.N.useGetNodeInfoQuery({nodeId:h},{pollingInterval:y}),w=N&&void 0===j,f=j,{activeTabVerified:I,nodeTabs:E}=n.useMemo((()=>{var e;const t=((null===f||void 0===f||null===(e=f.Roles)||void 0===e?void 0:e.find((e=>e===V)))?F.ZJ:F.ZJ.filter((e=>e.id!==F.P_))).map((e=>({...e,title:e.name})));let a=t.find((e=>{let{id:t}=e;return t===p}));return a||(a=t[0]),{activeTabVerified:a,nodeTabs:t}}),[p,f]),_=(null===f||void 0===f||null===(a=f.Tenants)||void 0===a?void 0:a[0])||(null===b||void 0===b?void 0:b.toString());let L;if(f){var U;const e=!(null!==f&&void 0!==f&&null!==(U=f.Tenants)&&void 0!==U&&U[0]);L=e?"Storage":"Compute"}n.useEffect((()=>{c((0,k.J)("node",{tenantName:_,nodeRole:L,nodeId:h}))}),[c,_,h,L]);const z=()=>{switch(I.id){case F.P_:return(0,m.jsx)("div",{className:R("storage"),children:(0,m.jsx)(P.V,{nodeId:h,parentContainer:d.current})});case F.IA:return(0,m.jsx)(B.J,{nodeId:h,database:_,className:R("node-page-wrapper")});case F.mD:return(0,m.jsx)(S,{node:f,className:R("overview-wrapper")});default:return!1}};return w?(0,m.jsx)(C.a,{size:"l"}):f?(0,m.jsxs)("div",{className:R(null,e.className),ref:d,children:[(0,m.jsx)(o.ql,{titleTemplate:`%s \u2014 ${f.Host} \u2014 YDB Monitoring`,defaultTitle:`${f.Host} \u2014 YDB Monitoring`,children:(0,m.jsx)("title",{children:I.title})}),(0,m.jsx)(g,{node:f,additionalNodesProps:e.additionalNodesProps,className:R("header")}),T?(0,m.jsx)(x.V,{error:T,className:R("error")}):null,(0,m.jsxs)("div",{className:R("tabs"),children:[(0,m.jsx)(r.m,{size:"l",items:E,activeTab:I.id,wrapTo:(e,t)=>{let{id:a}=e;return(0,m.jsx)(l.rU,{to:(0,D.ax)(D.ZP.node,{id:h,activeTab:a},{tenantName:_}),className:R("tab"),children:t},a)},allowNotSelected:!0}),(0,m.jsx)(i.q,{})]}),(0,m.jsx)("div",{className:R("content"),children:z()})]}):T?(0,m.jsx)(x.V,{error:T}):(0,m.jsx)("div",{className:"error",children:"no node data"})}},42635:(e,t,a)=>{a.d(t,{J:()=>z});var n=a(66950),r=a(10288),o=a(88776),s=a(17095),l=a(65070),i=a(41919),d=a(69214),c=a(26688),u=a(74170),v=a(2098),h=a(22692),p=a(97482),m=a(54665),b=a(14146),g=a(76386),x=a(36313),y=a(85690),j=a.n(y),N=a(905),T=a(99337);const w=N.h.injectEndpoints({endpoints:e=>({getTabletsInfo:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{return{data:await window.api.getTabletsInfo(e,{signal:a})}}catch(n){return{error:n}}},providesTags:["All",{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"}),f=(0,x.P1)((e=>e),(e=>w.endpoints.getTabletsInfo.select(e)),{argsMemoize:x.PP,argsMemoizeOptions:{equalityCheck:j()}}),I=(0,x.P1)((e=>e),((e,t)=>f(t)),((e,t)=>t(e).data)),S=(0,x.P1)(((e,t)=>I(e,t)),(e=>(0,T.d)(e)),((e,t)=>null!==e&&void 0!==e&&e.TabletStateInfo?t?e.TabletStateInfo.map((e=>{const a=void 0===e.NodeId?void 0:t.get(e.NodeId);return{...e,fqdn:a}})):e.TabletStateInfo:[]));var C=a(28164),D=a(24362),k=a(52317),A=a(34301),q=a(48169),P=a(17096),B=a(92398),F=a(30817);const R=JSON.parse('{"noTabletsData":"No tablets data","Type":"Type","Tablet":"Tablet","State":"State","Node ID":"Node ID","Node FQDN":"Node FQDN","Generation":"Generation","Uptime":"Uptime","dialog.kill-header":"Restart tablet","dialog.kill-text":"The tablet will be restarted. Do you want to proceed?","controls.kill-not-allowed":"You don\'t have enough rights to restart tablet"}'),V=(0,F.wZ)("ydb-tablets",{en:R});var E=a(75859);const _=(0,D.cn)("tablets");function L(e){let{database:t}=e;return[{name:"Type",get header(){return V("Type")},render:e=>{let{row:t}=e;const a=!1===t.Leader;return(0,E.jsxs)("span",{children:[t.Type," ",a?(0,E.jsx)(r.x,{color:"secondary",children:"follower"}):""]})}},{name:"TabletId",width:220,get header(){return V("Tablet")},render:e=>{var a;let{row:n}=e;if(!n.TabletId)return k.jX;const r=(0,m.fK)(n.TabletId,{nodeId:n.NodeId,type:n.Type,tenantName:t});return(0,E.jsx)(d.A,{name:null===(a=n.TabletId)||void 0===a?void 0:a.toString(),path:r,hasClipboardButton:!0,showStatus:!1,additionalControls:(0,E.jsx)(i.Q,{href:(0,q.wz)(n.TabletId)})})}},{name:"State",get header(){return V("State")},render:e=>{let{row:t}=e;return(0,E.jsx)(p.f,{state:t.State})}},{name:"NodeId",get header(){return V("Node ID")},render:e=>{let{row:t}=e;const a=void 0===t.NodeId?void 0:(0,B.a3)(t.NodeId);return(0,E.jsx)(u.h,{to:a,children:t.NodeId})},align:"right"},{name:"fqdn",get header(){return V("Node FQDN")},render:e=>{let{row:t}=e;return t.fqdn?(0,E.jsx)(d.A,{name:t.fqdn,showStatus:!1,hasClipboardButton:!0}):(0,E.jsx)("span",{children:"\u2014"})}},{name:"Generation",get header(){return V("Generation")},align:"right"},{name:"Uptime",get header(){return V("Uptime")},render:e=>{let{row:t}=e;return(0,A.fG)(t.ChangeTime)},sortAccessor:e=>-Number(e.ChangeTime),align:"right"},{name:"Actions",sortable:!1,resizeable:!1,header:"",render:e=>{let{row:t}=e;return(0,E.jsx)(U,{...t})}}]}function U(e){const t=e.State===C.g.Stopped,a=(0,P.ix)(b.VH),[r]=g._.useKillTabletMutation(),s=e.TabletId;return s?(0,E.jsx)(l.U,{buttonView:"outlined",dialogHeader:V("dialog.kill-header"),dialogText:V("dialog.kill-text"),onConfirmAction:()=>r({id:s}).unwrap(),buttonDisabled:t||!a,withPopover:!0,popoverContent:V("controls.kill-not-allowed"),popoverDisabled:a,children:(0,E.jsx)(o.J,{data:n.Z})}):null}function z(e){let{nodeId:t,path:a,database:n,className:r}=e;const[o]=(0,P.Rj)();let l={};const i=void 0===t?void 0:String(t);void 0!==i?l={nodeId:i,database:n}:a&&(l={path:a,database:n});const{currentData:d,isFetching:u,error:p}=w.useGetTabletsInfoQuery(0===Object.keys(l).length?s.CN:l,{pollingInterval:o}),m=u&&void 0===d,b=(0,P.ix)((e=>S(e,l)));return m?(0,E.jsx)(h.h,{}):(0,E.jsxs)("div",{className:_(null,r),children:[p?(0,E.jsx)(c.V,{error:p}):null,d?(0,E.jsx)(v.G,{columns:L({database:n}),data:b,settings:k.LE,emptyDataMessage:V("noTabletsData")}):null]})}},71698:(e,t,a)=>{a.d(t,{N:()=>s});var n=a(905),r=a(51688);const o=e=>{var t;if(null===(t=e.SystemStateInfo)||void 0===t||!t.length)return{};const a=e.SystemStateInfo[0];return(0,r.Ns)(a)},s=n.h.injectEndpoints({endpoints:e=>({getNodeInfo:e.query({queryFn:async(e,t)=>{let{nodeId:a}=e,{signal:n}=t;try{const e=await window.api.getNodeInfo(a,{signal:n});return{data:o(e)}}catch(r){return{error:r}}},providesTags:["All"]}),getNodeStructure:e.query({queryFn:async(e,t)=>{let{nodeId:a}=e,{signal:n}=t;try{return{data:await window.api.getStorageInfo({nodeId:a},{signal:n})}}catch(r){return{error:r}}},providesTags:["All"]})}),overrideExisting:"throw"})},76386:(e,t,a)=>{a.d(t,{_:()=>r});var n=a(51688);const r=a(905).h.injectEndpoints({endpoints:e=>({getTablet:e.query({queryFn:async(e,t)=>{let{id:a,database:r,nodeId:o}=e,{signal:s}=t;try{const[e,t,l]=await Promise.all([window.api.getTablet({id:a,database:r,nodeId:o},{signal:s}),window.api.getTabletHistory({id:a,database:r,nodeId:o},{signal:s}),window.api.getNodesList({signal:s})]),i=(0,n.dn)(l),d=Object.keys(t).reduce(((e,a)=>{var n;const r=null===(n=t[a])||void 0===n?void 0:n.TabletStateInfo;if(r&&r.length){const t=r.find((e=>e.Leader))||r[0],{ChangeTime:n,Generation:o,State:s,Leader:l,FollowerId:d}=t,c=i&&a?i.get(Number(a)):void 0;"Dead"!==s&&e.push({nodeId:a,generation:o,changeTime:n,state:s,leader:l,followerId:d,fqdn:c})}return e}),[]),{TabletStateInfo:c=[]}=e,[u={}]=c,{TabletId:v}=u;return{data:{id:v,data:u,history:d}}}catch(l){return{error:l}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),getTabletDescribe:e.query({queryFn:async(e,t)=>{let{tenantId:a}=e,{signal:n}=t;try{const e=await window.api.getTabletDescribe(a,{signal:n}),{SchemeShard:t,PathId:r}=a;return{data:(null===e||void 0===e?void 0:e.Path)||`${t}:${r}`}}catch(r){return{error:r}}},providesTags:["All"]}),getAdvancedTableInfo:e.query({queryFn:async(e,t)=>{let{id:a,hiveId:n}=e,{signal:r}=t;try{return{data:await window.api.getTabletFromHive({id:a,hiveId:n},{signal:r})}}catch(o){return{error:o}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),killTablet:e.mutation({queryFn:async e=>{let{id:t}=e;try{return{data:await window.api.killTablet(t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),stopTablet:e.mutation({queryFn:async e=>{let{id:t,hiveId:a}=e;try{return{data:await window.api.stopTablet(t,a)}}catch(n){return{error:n}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),resumeTablet:e.mutation({queryFn:async e=>{let{id:t,hiveId:a}=e;try{return{data:await window.api.resumeTablet(t,a)}}catch(n){return{error:n}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"})}}]);