"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[7667],{41919:(e,t,r)=>{r.d(t,{Q:()=>d});var s=r(39683),n=r(17176),l=r(88776),a=r(24362),o=r(75859);const i=(0,a.cn)("developer-ui-link-button");function d(e){let{href:t,visible:r=!1,className:a}=e;return(0,o.jsx)(n.z,{size:"s",href:t,className:i({visible:r},a),target:"_blank",children:(0,o.jsx)(l.J,{data:s.Z})})}},49201:(e,t,r)=>{r.d(t,{C:()=>i});var s=r(14979),n=r(24362);const l=(0,r(30817).wZ)("ydb-entities-count",{ru:{of:"\u0438\u0437"},en:{of:"of"}});var a=r(75859);const o=(0,n.cn)("ydb-entities-count"),i=e=>{let{total:t,current:r,label:n,loading:i,className:d}=e,u="";return n&&(u+=`${n}: `),i?u+="...":(u+=`${r}`,t&&Number(t)!==Number(r)&&(u+=` ${l("of")} ${t}`)),(0,a.jsx)(s._,{theme:"info",size:"m",className:o(null,d),children:u})}},62776:(e,t,r)=>{r.d(t,{a:()=>s.a});var s=r(91173)},89778:(e,t,r)=>{r.d(t,{k:()=>m});var s=r(10502),n=r(92398),l=r(48169),a=r(51688),o=r(99683),i=r(41919),d=r(69214),u=r(27506),c=r(75859);const m=e=>{let{node:t,getNodeRef:r,database:m}=e;if(!t.Host)return(0,c.jsx)("span",{children:"\u2014"});const h=!(0,a.TA)(t);let p;r?p=r(t)+"internal":t.NodeId&&(p=(0,l.wq)(t.NodeId)+"internal");const g=h?(0,n.a3)(t.NodeId,{tenantName:null!==m&&void 0!==m?m:t.TenantName}):void 0,v=p?(0,c.jsx)(i.Q,{href:p}):null;return(0,c.jsx)(o.l,{disabled:!h,content:(0,c.jsx)(u.bP,{data:t}),placement:["top","bottom"],behavior:s.x.Immediate,children:(0,c.jsx)(d.A,{name:t.Host,status:t.SystemState,path:g,hasClipboardButton:!0,additionalControls:v})})}},11635:(e,t,r)=>{r.d(t,{WQ:()=>G});var s=r(68963),n=r(5922),l=r(47101);const a=r(905).h.injectEndpoints({endpoints:function(e){return{fetchTableChunk:e.query({queryFn:async(e,t)=>{let{offset:r,limit:s,sortParams:n,filters:l,fetchData:a}=e,{signal:o}=t;try{return{data:await a({limit:s,offset:r,filters:l,sortParams:n,signal:o})}}catch(i){return{error:i}}},providesTags:["All"]})}}});var o=r(17096),i=r(26688),d=r(56711);const u="left",c=!0,m=-1,h=40;const p=(0,r(24362).cn)("ydb-paginated-table");var g=r(75859);const v=e=>{let{children:t,className:r,height:s,width:n,align:l=u,resizeable:a}=e;return(0,g.jsx)("td",{className:p("row-cell",{align:l},r),style:{height:`${s}px`,width:`${n}px`,maxWidth:a?`${n}px`:void 0},children:t})},f=e=>{let{index:t,columns:r,height:s}=e;return(0,g.jsx)("tr",{className:p("row",{loading:!0}),children:r.map((e=>{var r;const n=null!==(r=e.resizeable)&&void 0!==r?r:c;return(0,g.jsx)(v,{height:s,width:e.width,align:e.align,className:e.className,resizeable:n,children:(0,g.jsx)(d.O,{className:p("row-skeleton"),style:{width:"80%",height:"50%"}})},`${e.name}${t}`)}))})},b=e=>{let{row:t,index:r,columns:s,getRowClassName:n,height:l}=e;const a=null===n||void 0===n?void 0:n(t);return(0,g.jsx)("tr",{className:p("row",a),children:s.map((e=>{var s;const n=null!==(s=e.resizeable)&&void 0!==s?s:c;return(0,g.jsx)(v,{height:l,width:e.width,align:e.align,className:e.className,resizeable:n,children:e.render({row:t,index:r})},`${e.name}${r}`)}))})},w=e=>{let{columns:t,children:r}=e;return(0,g.jsx)("tr",{className:p("row",{empty:!0}),children:(0,g.jsx)("td",{colSpan:t.length,className:p("td"),children:r})})},x=(0,s.memo)((function(e){var t;let{id:r,limit:l,rowHeight:d,columns:u,fetchData:c,tableName:m,filters:h,sortParams:p,observer:v,getRowClassName:x,renderErrorMessage:N,onDataFetched:j,isActive:y}=e;const C=s.useRef(null),[S,E]=s.useState(!0),[O]=(0,o.Rj)(),U={offset:r*l,limit:l,fetchData:c,filters:h,sortParams:p,tableName:m};a.useFetchTableChunkQuery(U,{skip:S||!y,pollingInterval:O});const{currentData:I,error:A}=a.endpoints.fetchTableChunk.useQueryState(U);s.useEffect((()=>{let e=0;return y&&S&&(e=window.setTimeout((()=>{E(!1)}),200)),()=>{window.clearTimeout(e)}}),[y,S]),s.useEffect((()=>{const e=C.current;return e&&v.observe(e),()=>{e&&v.unobserve(e)}}),[v]),s.useEffect((()=>{if(I&&y){const{total:e=0,found:t=0}=I;j(e,t)}}),[I,y,j]);const F=(null===I||void 0===I||null===(t=I.data)||void 0===t?void 0:t.length)||l,G=F?F*d:l*d;return(0,g.jsx)("tbody",{ref:C,id:r.toString(),style:{height:`${G}px`,display:y?"table-row-group":"block"},children:(()=>{if(!y)return null;if(!I){if(A){const e=A;return(0,g.jsx)(w,{columns:u,children:N?N(e):(0,g.jsx)(i.V,{error:e})})}return(0,n.c$)(F).map((e=>(0,g.jsx)(f,{columns:u,height:d,index:e},e)))}return I.data.map(((e,t)=>(0,g.jsx)(b,{index:t,row:e,columns:u,height:d,getRowClassName:x},t)))})()})}));function N(e){let{minWidth:t,maxWidth:r,getCurrentColumnWidth:n,onResize:l}=e;const a=s.useRef(null),[o,i]=s.useState(!1);return s.useEffect((()=>{const e=a.current;if(!e)return;let s,o,d;const u=function(e){let t,r=null;return function(){for(var s=arguments.length,n=new Array(s),l=0;l<s;l++)n[l]=arguments[l];t=n,"number"!==typeof r&&(r=requestAnimationFrame((()=>{e(...t),r=null})))}}((e=>{if(j(e),"number"!==typeof s||"number"!==typeof o)return;const n=e.clientX-s,a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return Math.max(t,Math.min(e,r))}(o+n,t,r);a!==d&&(d=a,null===l||void 0===l||l(d))})),c=e=>{j(e),void 0!==d&&(null===l||void 0===l||l(d)),i(!1),s=void 0,document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c)},m=e=>{o=n(),j(e),s=e.clientX,i(!0),document.addEventListener("mousemove",u),document.addEventListener("mouseup",c)};return e.addEventListener("mousedown",m),()=>{e.removeEventListener("mousedown",m),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c)}}),[l,t,r,n]),(0,g.jsx)("span",{ref:a,className:p("resize-handler",{resizing:o}),onClick:e=>j(e)})}function j(e){e.preventDefault(),e.stopPropagation()}const y=e=>{let{order:t}=e;return(0,g.jsx)("svg",{className:p("sort-icon",{desc:-1===t}),viewBox:"0 0 10 6",width:"10",height:"6",children:(0,g.jsx)("path",{fill:"currentColor",d:"M0 5h10l-5 -5z"})})},C=e=>{let{sortOrder:t,sortable:r,defaultSortOrder:s}=e;return r?(0,g.jsx)("span",{className:p("sort-icon-container",{shadow:!t}),children:(0,g.jsx)(y,{order:t||s})}):null},S=e=>{var t;let{column:r,resizeable:n,sortOrder:l,defaultSortOrder:a,onSort:o,rowHeight:i,onCellMount:d,onCellUnMount:u,onColumnsResize:c}=e;const m=s.useRef(null);s.useEffect((()=>{const e=m.current;return e&&(null===d||void 0===d||d(e)),()=>{e&&(null===u||void 0===u||u(e))}}),[d,u]);const h=s.useCallback((()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.getBoundingClientRect().width}),[]),v=s.useCallback((e=>{null===c||void 0===c||c(r.name,e)}),[c,r.name]),f=null!==(t=r.header)&&void 0!==t?t:r.name,b={height:`${i}px`,width:`${r.width}px`,minWidth:n?`${r.width}px`:void 0,maxWidth:n?`${r.width}px`:void 0};return(0,g.jsxs)("th",{ref:m,className:p("head-cell-wrapper"),style:b,children:[(0,g.jsxs)("div",{className:p("head-cell",{align:r.align,sortable:r.sortable},r.className),onClick:()=>{r.sortable&&(null===o||void 0===o||o(r.name))},children:[(0,g.jsx)("div",{className:p("head-cell-content"),children:f}),(0,g.jsx)(C,{sortOrder:l,sortable:r.sortable,defaultSortOrder:a})]}),n?(0,g.jsx)(N,{maxWidth:r.resizeMaxWidth,minWidth:r.resizeMinWidth,getCurrentColumnWidth:h,onResize:v}):null]})},E=e=>{let{columns:t,onSort:r,onColumnsResize:n,defaultSortOrder:l=m,rowHeight:a=h}=e;const[o,i]=s.useState({}),d=e=>{let t={};if(e===o.columnId){if(o.sortOrder&&o.sortOrder!==l)return i(t),void(null===r||void 0===r||r(t));t={sortOrder:1===o.sortOrder?-1:1,columnId:e}}else t={sortOrder:l,columnId:e};null===r||void 0===r||r(t),i(t)};return(0,g.jsxs)(s.Fragment,{children:[(0,g.jsx)("colgroup",{children:t.map((e=>(0,g.jsx)("col",{style:{width:`${e.width}px`}},e.name)))}),(0,g.jsx)("thead",{className:p("head"),children:(0,g.jsx)("tr",{children:t.map((e=>{var t;const r=o.columnId===e.name?o.sortOrder:void 0,s=n&&(null!==(t=e.resizeable)&&void 0!==t?t:c);return(0,g.jsx)(S,{column:e,resizeable:s,sortOrder:r,defaultSortOrder:l,onSort:d,rowHeight:a,onColumnsResize:n},e.name)}))})})]})};var O=r(30817);const U=JSON.parse('{"empty":"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"}'),I=(0,O.wZ)("ydb-paginated-table",{ru:U,en:{empty:"No data"}}),A=e=>{let{limit:t,fetchData:r,filters:a,tableName:o,columns:i,getRowClassName:d,rowHeight:u=h,parentContainer:c,initialSortParams:m,onColumnsResize:v,renderControls:f,renderErrorMessage:b,renderEmptyDataMessage:N,containerClassName:j}=e;const[y,C]=s.useState(m),[S,O]=s.useState(t),[U,A]=s.useState(0),[F,G]=s.useState([]),[k,_]=s.useState(!0),D=s.useRef(null),P=s.useCallback(((e,t)=>{O(e),A(t),_(!1)}),[]),R=(e=>{let{onEntry:t,onLeave:r,parentContainer:n}=e;const l=s.useRef();return s.useEffect((()=>(l.current=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting?t(e.target.id):r(e.target.id)}))}),{root:n,rootMargin:"100%"}),()=>{var e;null===(e=l.current)||void 0===e||e.disconnect(),l.current=void 0})),[n,t,r]),l.current})({onEntry:s.useCallback((e=>{G((t=>[...new Set([...t,Number(e)])]))}),[]),onLeave:s.useCallback((e=>{G((t=>t.filter((t=>t!==Number(e)))))}),[]),parentContainer:c});s.useLayoutEffect((()=>{var e;(O(t),A(0),_(!0),c)?c.scrollTo(0,0):null===(e=D.current)||void 0===e||e.scrollTo(0,0);G([0])}),[a,t,c]);const T=()=>{if(!R)return null;if(!k&&0===U)return(0,g.jsx)("tbody",{children:(0,g.jsx)(w,{columns:i,children:N?N():I("empty")})});const e=U||t,s=Math.ceil(e/t);return(0,n.c$)(s).map((e=>(0,g.jsx)(x,{id:e,limit:t,rowHeight:u,columns:i,fetchData:r,filters:a,tableName:o,sortParams:y,getRowClassName:d,renderErrorMessage:b,onDataFetched:P,isActive:F.includes(e),observer:R},e)))},M=()=>(0,g.jsxs)("table",{className:p("table"),children:[(0,g.jsx)(E,{columns:i,onSort:C,onColumnsResize:v}),T()]});return(0,g.jsx)("div",{ref:D,className:p(null,j),children:f?(0,g.jsxs)(l.l,{children:[(0,g.jsx)(l.l.Controls,{children:f({inited:!k,totalEntities:S,foundEntities:U})}),(0,g.jsx)(l.l.Table,{children:M()})]}):M()})};var F=r(89712);function G(e){let{columnsWidthLSKey:t,columns:r,...s}=e;const[n,l]=(0,F.M)(t),a=function(e,t){return e.map((e=>{var r;return{...e,width:null!==(r=t[e.name])&&void 0!==r?r:e.width}}))}(r,n);return(0,g.jsx)(A,{columns:a,onColumnsResize:l,containerClassName:p("resizeable-table-container"),...s})}},30629:(e,t,r)=>{r.d(t,{o:()=>i});var s=r(68963),n=r(77264),l=r(24362),a=r(75859);const o=(0,l.cn)("ydb-search"),i=e=>{let{onChange:t,value:r="",className:l,debounce:i=200,placeholder:d}=e;const[u,c]=s.useState(r),m=s.useRef();s.useEffect((()=>{c((e=>e!==r?r:e))}),[r]);return(0,a.jsx)(n.o,{hasClear:!0,autoFocus:!0,className:o(null,l),placeholder:d,value:u,onUpdate:e=>{c(e),window.clearTimeout(m.current),m.current=window.setTimeout((()=>{null===t||void 0===t||t(e)}),i)}})}},22692:(e,t,r)=>{r.d(t,{h:()=>o});var s=r(56711),n=r(24362),l=r(75859);const a=(0,n.cn)("table-skeleton"),o=e=>{let{rows:t=2,className:r}=e;return(0,l.jsxs)("div",{className:a(null,r),children:[(0,l.jsxs)("div",{className:a("row"),children:[(0,l.jsx)(s.O,{className:a("col-1")}),(0,l.jsx)(s.O,{className:a("col-2")}),(0,l.jsx)(s.O,{className:a("col-3")}),(0,l.jsx)(s.O,{className:a("col-4")}),(0,l.jsx)(s.O,{className:a("col-5")})]}),[...new Array(t)].map(((e,t)=>(0,l.jsx)("div",{className:a("row"),children:(0,l.jsx)(s.O,{className:a("col-full")})},`skeleton-row-${t}`)))]})}},47101:(e,t,r)=>{r.d(t,{l:()=>o});var s=r(24362),n=r(22692),l=r(75859);const a=(0,s.cn)("ydb-table-with-controls-layout"),o=e=>{let{children:t,className:r}=e;return(0,l.jsx)("div",{className:a(null,r),children:t})};o.Controls=function(e){let{children:t,className:r}=e;return(0,l.jsx)("div",{className:a("controls-wrapper"),children:(0,l.jsx)("div",{className:a("controls",r),children:t})})},o.Table=function(e){let{children:t,loading:r,className:s}=e;return r?(0,l.jsx)(n.h,{className:a("loader")}):(0,l.jsx)("div",{className:a("table",s),children:t})}},43989:(e,t,r)=>{r.d(t,{X:()=>a});var s=r(79734),n=r(51688),l=r(75859);const a=e=>{let{value:t,onChange:r,className:a}=e;return(0,l.jsxs)(s.E,{value:t,onUpdate:r,className:a,children:[(0,l.jsx)(s.E.Option,{value:n.Uu.All,children:n.qU[n.Uu.All]}),(0,l.jsx)(s.E.Option,{value:n.Uu.SmallUptime,children:n.qU[n.Uu.SmallUptime]})]})}},59625:(e,t,r)=>{r.d(t,{y:()=>c});var s=r(17176),n=r(79023),l=r(56350),a=r(30817);const o=JSON.parse('{"default_message":"Everything is fine!","default_button_label":"Show All"}'),i=JSON.parse('{"default_message":"\u0412\u0441\u0451 \u0432 \u043f\u043e\u0440\u044f\u0434\u043a\u0435!","default_button_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435"}'),d=(0,a.wZ)("ydb-storage-empty-filter",{ru:i,en:o});var u=r(75859);const c=e=>{let{title:t,message:r=d("default_message"),showAll:a=d("default_button_label"),onShowAll:o}=e;return(0,u.jsx)(n.u,{image:(0,u.jsx)(l.Q,{name:"thumbsUp"}),position:"left",title:t,description:r,actions:o&&[(0,u.jsx)(s.z,{onClick:o,children:a},"show-all")]})}},6787:(e,t,r)=>{r.d(t,{n:()=>u});var s=r(2098),n=r(95829),l=r(64782),a=r(77382),o=r(46393),i=r(43817),d=r(75859);function u(e){let{data:t,tableSettings:r,visibleEntities:u,onShowAll:c,sort:m,handleSort:h}=e;const p=(0,o.V)(u);return t.length||u===n.G.all?(0,d.jsx)(s.G,{columnsWidthLSKey:a.Ty,data:t,columns:p,settings:r,emptyDataMessage:(0,i.Z)("empty.default"),sortOrder:m,onSort:h},u):(0,d.jsx)(l.a,{onShowAll:c,visibleEntities:u})}},64782:(e,t,r)=>{r.d(t,{a:()=>o});var s=r(95829),n=r(59625),l=r(43817),a=r(75859);const o=e=>{let t,{visibleEntities:r,onShowAll:o}=e;return r===s.G.space&&(t=(0,l.Z)("empty.out_of_space")),r===s.G.missing&&(t=(0,l.Z)("empty.degraded")),t?(0,a.jsx)(n.y,{title:t,showAll:(0,l.Z)("show_all"),onShowAll:o}):null}},32916:(e,t,r)=>{r.d(t,{k:()=>c});var s=r(2098),n=r(95829),l=r(51688),a=r(64682),o=r(78889),i=r(73790),d=r(20108),u=r(75859);function c(e){let{data:t,tableSettings:r,visibleEntities:c,onShowAll:m,nodesUptimeFilter:h,additionalNodesProps:p,sort:g,handleSort:v,database:f}=e;const b=(0,o.E8)(p,c,f);return t.length||c===n.G.all&&h===l.Uu.All?(0,u.jsx)(s.G,{columnsWidthLSKey:o.Wj,data:t,columns:b,settings:{...r,dynamicRenderType:"variable"},emptyDataMessage:(0,i.Z)("empty.default"),rowClassName:d.q,sortOrder:g,onSort:v},c):(0,u.jsx)(a.r,{visibleEntities:c,nodesUptimeFilter:h,onShowAll:m})}},64682:(e,t,r)=>{r.d(t,{r:()=>i});var s=r(95829),n=r(51688),l=r(59625),a=r(73790),o=r(75859);const i=e=>{let t,{visibleEntities:r,nodesUptimeFilter:i,onShowAll:d}=e;return r===s.G.space&&(t=(0,a.Z)("empty.out_of_space")),r===s.G.missing&&(t=(0,a.Z)("empty.degraded")),i===n.Uu.SmallUptime&&(t=(0,a.Z)("empty.small_uptime")),r!==s.G.all&&i!==n.Uu.All&&(t=(0,a.Z)("empty.several_filters")),t?(0,o.jsx)(l.y,{title:t,showAll:(0,a.Z)("show_all"),onShowAll:d}):null}},78889:(e,t,r)=>{r.d(t,{E8:()=>w,Wj:()=>c});var s=r(19812),n=r(89778),l=r(95829),a=r(52317),o=r(51688),i=r(17931),d=r(20108),u=r(75859);const c="storageNodesColumnsWidth",m="NodeId",h="Host",p="DC",g="Rack",v="Uptime",f="PDisks",b="Missing",w=(e,t,r)=>{const c=((e,t)=>{const r=null===e||void 0===e?void 0:e.getNodeRef;return[{name:m,header:"Node ID",width:100,align:s.ZP.RIGHT,render:e=>{let{row:t}=e;return t.NodeId}},{name:h,header:"Host",width:350,render:e=>{let{row:s}=e;return(0,u.jsx)(n.k,{node:s,getNodeRef:r,database:t})},align:s.ZP.LEFT},{name:p,header:"DC",width:100,render:e=>{let{row:t}=e;return t.DC||a.jX},align:s.ZP.LEFT},{name:g,header:"Rack",width:100,render:e=>{let{row:t}=e;return t.Rack||"\u2014"},align:s.ZP.LEFT},{name:v,header:"Uptime",width:130,sortAccessor:e=>{let{StartTime:t}=e;return t?-t:0},align:s.ZP.RIGHT,render:e=>{let{row:t}=e;return t.Uptime}},{name:b,header:"Missing",width:100,align:s.ZP.CENTER,defaultOrder:s.ZP.DESCENDING,render:e=>{let{row:t}=e;return t.Missing}},{name:f,className:(0,d.b)("pdisks-column"),header:"PDisks",render:e=>{var t;let{row:r}=e;return(0,u.jsx)("div",{className:(0,d.b)("pdisks-wrapper"),children:null===(t=r.PDisks)||void 0===t?void 0:t.map((e=>{var t;const s=null===(t=r.VDisks)||void 0===t?void 0:t.filter((t=>t.PDiskId===e.PDiskId));return(0,u.jsx)("div",{className:(0,d.b)("pdisks-item"),children:(0,u.jsx)(i.l,{data:e,vDisks:s})},e.PDiskId)}))})},align:s.ZP.CENTER,sortable:!1,width:900,resizeable:!1}]})(e,r),w=c.map((e=>({...e,sortable:(0,o.oh)(e.name)})));return t!==l.G.missing?w.filter((e=>e.name!==b)):w}},73790:(e,t,r)=>{r.d(t,{Z:()=>a});var s=r(30817);const n=JSON.parse('{"empty.default":"No such nodes","empty.out_of_space":"No nodes with out of space errors","empty.degraded":"No degraded nodes","empty.small_uptime":"No nodes with uptime < 1h","empty.several_filters":"No nodes match current filters combination","show_all":"Show all nodes"}'),l=JSON.parse('{"empty.default":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432","empty.out_of_space":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043a\u043e\u043d\u0447\u0430\u0435\u0442\u0441\u044f \u043c\u0435\u0441\u0442\u043e","empty.degraded":"\u041d\u0435\u0442 \u0434\u0435\u0433\u0440\u0430\u0434\u0438\u0440\u043e\u0432\u0430\u0432\u0448\u0438\u0445 \u0443\u0437\u043b\u043e\u0432","empty.small_uptime":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432 \u0441 uptime < 1h","empty.several_filters":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432, \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u043f\u043e\u0434 \u0442\u0435\u043a\u0443\u0449\u0438\u0435 \u0444\u0438\u043b\u044c\u0442\u0440\u044b","show_all":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435 \u0443\u0437\u043b\u044b"}'),a=(0,s.wZ)("ydb-storage-nodes",{ru:l,en:n})},20108:(e,t,r)=>{r.d(t,{b:()=>l,q:()=>a});var s=r(24362),n=r(51688);const l=(0,s.cn)("global-storage-nodes"),a=e=>l("node",{unavailable:(0,n.TA)(e)})},19897:(e,t,r)=>{r.d(t,{V:()=>we});var s=r(52317),n=r(17096),l=r(52846),a=r(82073),o=r(8747),i=r(95829),d=r(95408);const u=d.z.nativeEnum(i.G).catch(i.G.all),c=d.z.nativeEnum(i.d).catch(i.d.groups);var m=r(51688),h=r(68963),p=r(49201),g=r(30629),v=r(43989),f=r(79734),b=r(75859);const w={[i.d.groups]:"Groups",[i.d.nodes]:"Nodes"},x=e=>{let{value:t,onChange:r}=e;return(0,b.jsxs)(f.E,{value:t,onUpdate:r,qa:"storage-type-filter",children:[(0,b.jsx)(f.E.Option,{value:i.d.groups,children:w[i.d.groups]}),(0,b.jsx)(f.E.Option,{value:i.d.nodes,children:w[i.d.nodes]})]})},N={[i.G.all]:"All",[i.G.missing]:"Degraded",[i.G.space]:"Out of Space"},j=e=>{let{value:t,onChange:r}=e;return(0,b.jsxs)(f.E,{value:t,onUpdate:r,qa:"storage-visible-entities-filter",children:[(0,b.jsx)(f.E.Option,{value:i.G.missing,children:N[i.G.missing]}),(0,b.jsx)(f.E.Option,{value:i.G.space,children:N[i.G.space]}),(0,b.jsx)(f.E.Option,{value:i.G.all,children:N[i.G.all]})]})};var y=r(2418),C=r(69214),S=r(24362),E=r(10703),O=r(30817);const U=JSON.parse('{"label":"Usage:","default_value":"Any","groups_count":["{{count}} group","{{count}} groups","{{count}} groups","No groups"]}'),I=JSON.parse('{"label":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435:","default_value":"\u041b\u044e\u0431\u043e\u0435","groups_count":["{{count}} \u0433\u0440\u0443\u043f\u043f\u0430","{{count}} \u0433\u0440\u0443\u043f\u043f\u044b","{{count}} \u0433\u0440\u0443\u043f\u043f","\u041d\u0435\u0442 \u0433\u0440\u0443\u043f\u043f"]}'),A=(0,O.wZ)("ydb-usage-filter",{ru:I,en:U}),F=(0,S.cn)("usage-filter"),G=e=>{const{className:t,value:r=[],groups:s=[],onChange:n,debounce:l=200}=e,[a,o]=h.useState(r),i=h.useRef();h.useEffect((()=>{o((e=>e.join(",")!==r.join(",")?r:e))}),[r]);const d=h.useMemo((()=>s.map((e=>{let{threshold:t,count:r}=e;return{value:String(t),text:`${t}%`,data:{count:r}}}))),[s]),u=Math.max(...s.map((e=>{let{count:t}=e;return t})));return(0,b.jsx)(y.P,{className:F(null,t),label:A("label"),value:a,placeholder:A("default_value"),options:d,multiple:!0,onUpdate:e=>{o(e),window.clearTimeout(i.current),i.current=window.setTimeout((()=>{null===n||void 0===n||n(e)}),l)},renderOption:e=>{let{value:t,data:r,text:s}=e;return(0,b.jsxs)("div",{className:F("option"),children:[(0,b.jsx)(C.A,{className:F("option-title"),status:(0,E.CZ)(Number(t)),name:s,size:"xs"}),(0,b.jsxs)("div",{className:F("option-meta"),children:[A("groups_count",{count:r.count}),(0,b.jsx)("div",{className:F("option-bar"),style:{width:r.count/u*100+"%"}})]})]})},getOptionHeight:()=>50,popupWidth:280,disabled:0===s.length})},k=JSON.parse('{"groups":"Groups","nodes":"Nodes","controls_groups-search-placeholder":"Group ID, Pool name","controls_nodes-search-placeholder":"Node ID, FQDN"}'),_=JSON.parse('{"groups":"\u0413\u0440\u0443\u043f\u043f\u044b","nodes":"\u041d\u043e\u0434\u044b","controls_groups-search-placeholder":"ID \u0433\u0440\u0443\u043f\u043f\u044b, \u0438\u043c\u044f \u043f\u0443\u043b\u0430","controls_nodes-search-placeholder":"ID \u0443\u0437\u043b\u0430, FQDN"}'),D=(0,O.wZ)("ydb-storage",{ru:_,en:k}),P=(0,S.cn)("global-storage"),R=e=>{let{searchValue:t,handleSearchValueChange:r,withTypeSelector:s,storageType:n,handleStorageTypeChange:l,visibleEntities:a,handleVisibleEntitiesChange:o,nodesUptimeFilter:d,handleNodesUptimeFilterChange:u,withGroupsUsageFilter:c,groupsUsageFilter:m,groupsUsageFilterOptions:f,handleGroupsUsageFilterChange:w,entitiesCountCurrent:N,entitiesCountTotal:y,entitiesLoading:C}=e;const S=n===i.d.nodes,E=D(S?"nodes":"groups");return(0,b.jsxs)(h.Fragment,{children:[(0,b.jsx)(g.o,{value:t,onChange:r,placeholder:D(S?"controls_nodes-search-placeholder":"controls_groups-search-placeholder"),className:P("search")}),s&&(0,b.jsx)(x,{value:n,onChange:l}),(0,b.jsx)(j,{value:a,onChange:o}),S&&(0,b.jsx)(v.X,{value:d,onChange:u}),!S&&c&&(0,b.jsx)(G,{value:m,onChange:w,groups:f}),(0,b.jsx)(p.C,{label:E,loading:C,total:y,current:N})]})};var T=r(96409),M=r(11635),L=r(17880),z=r(64782),Z=r(77382),V=r(46393),W=r(26491),$=r(27070);const K=(e,t)=>`getStorageGroups|offset${t}|limit${e}`;var H=r(43817);const Q=e=>{let{searchValue:t,visibleEntities:r,database:s,nodeId:n,onShowAll:l,parentContainer:a,renderControls:o,renderErrorMessage:d}=e;const u=(0,V.V)(r),c=(0,L.rU)(),m=(0,L.tS)(),p=(g=m,h.useCallback((async e=>{const{limit:t,offset:r,sortParams:s,filters:n}=e,{sortOrder:l,columnId:a}=null!==s&&void 0!==s?s:{},{searchValue:o,visibleEntities:i,database:d,nodeId:u}=null!==n&&void 0!==n?n:{},c=(0,$.A)(a,l),{groups:m,found:h,total:p}=await(0,W.R)({limit:t,offset:r,sort:c,filter:o,with:i,database:d,nodeId:u,shouldUseGroupsHandler:g},{concurrentId:K(t,r)});return{data:m||[],found:h||0,total:p||0}}),[g]));var g;const v=h.useMemo((()=>({searchValue:t,visibleEntities:r,database:s,nodeId:n})),[t,r,s,n]);return(0,b.jsx)(T.s,{loading:!c,children:(0,b.jsx)(M.WQ,{columnsWidthLSKey:Z.Ty,parentContainer:a,columns:u,fetchData:p,limit:50,renderControls:o,renderErrorMessage:d,renderEmptyDataMessage:()=>r!==i.G.all?(0,b.jsx)(z.a,{onShowAll:l,visibleEntities:r}):(0,H.Z)("empty.default"),filters:v,tableName:"storage-groups"})})};var Y=r(64682),J=r(92092);const q=(e,t)=>`getStorageNodes|offset${t}|limit${e}`,B=async e=>{const{type:t="static",storage:r=!0,limit:s,offset:n,sortParams:l,filters:a}=e,{searchValue:o,nodesUptimeFilter:i,visibleEntities:d,database:u}=null!==a&&void 0!==a?a:{},{sortOrder:c,columnId:h}=null!==l&&void 0!==l?l:{},p=await window.api.getNodes({type:t,storage:r,limit:s,offset:n,sortOrder:c,sortValue:h,filter:o,uptime:(0,m.RW)(i),visibleEntities:d,database:u},{concurrentId:q(s,n)}),g=(0,J.Y2)(p);return{data:g.nodes||[],found:g.found||0,total:g.total||0}};var X=r(78889),ee=r(73790),te=r(20108);const re=e=>{let{searchValue:t,visibleEntities:r,nodesUptimeFilter:s,database:n,additionalNodesProps:l,onShowAll:a,parentContainer:o,renderControls:d,renderErrorMessage:u}=e;const c=h.useMemo((()=>({searchValue:t,visibleEntities:r,nodesUptimeFilter:s,database:n})),[t,r,s,n]),p=h.useMemo((()=>(0,X.E8)(l,r,n)),[l,r,n]);return(0,b.jsx)(M.WQ,{columnsWidthLSKey:X.Wj,parentContainer:o,columns:p,fetchData:B,rowHeight:51,limit:50,renderControls:d,renderErrorMessage:u,renderEmptyDataMessage:()=>r!==i.G.all||s!==m.Uu.All?(0,b.jsx)(Y.r,{onShowAll:a,nodesUptimeFilter:s,visibleEntities:r}):(0,ee.Z)("empty.default"),getRowClassName:te.q,filters:c,tableName:"storage-nodes"})},se=e=>{var t;let{database:r,nodeId:s,parentContainer:n,additionalNodesProps:d}=e;const[h,p]=(0,l.useQueryParams)({type:l.StringParam,visible:l.StringParam,search:l.StringParam,uptimeFilter:l.StringParam}),g=c.parse(h.type),v=u.parse(h.visible),f=null!==(t=h.search)&&void 0!==t?t:"",w=m.U8.parse(h.uptimeFilter),x=e=>{p({search:e||void 0},"replaceIn")},N=e=>{p({visible:e},"replaceIn")},j=e=>{p({type:e},"replaceIn")},y=e=>{p({uptimeFilter:e},"replaceIn")},C=()=>{p({visible:i.G.all,uptimeFilter:m.Uu.All},"replaceIn")},S=e=>{let{totalEntities:t,foundEntities:r,inited:n}=e;return(0,b.jsx)(R,{searchValue:f,handleSearchValueChange:x,withTypeSelector:!s,storageType:g,handleStorageTypeChange:j,visibleEntities:v,handleVisibleEntitiesChange:N,nodesUptimeFilter:w,handleNodesUptimeFilterChange:y,withGroupsUsageFilter:!1,entitiesCountCurrent:r,entitiesCountTotal:t,entitiesLoading:!n})},E=e=>403===e.status?(0,b.jsx)(a.J,{position:"left"}):(0,b.jsx)(o.V,{error:e});return g===i.d.nodes?(0,b.jsx)(re,{searchValue:f,visibleEntities:v,nodesUptimeFilter:w,database:r,additionalNodesProps:d,onShowAll:C,parentContainer:n,renderControls:S,renderErrorMessage:E}):(0,b.jsx)(Q,{searchValue:f,visibleEntities:v,database:r,nodeId:s,onShowAll:()=>{N(i.G.all)},parentContainer:n,renderControls:S,renderErrorMessage:E})};var ne=r(86969),le=r(1440),ae=r(26688),oe=r(47101),ie=r(15106),de=r(14223);const ue=e=>e.trim().toLowerCase(),ce=(e,t)=>{const r=ue(t);return r?e.filter((e=>{var t,s;return(null===(t=e.NodeId)||void 0===t?void 0:t.toString().includes(r))||(null===(s=e.Host)||void 0===s?void 0:s.toLowerCase().includes(r))})):e},me=(e,t)=>{const r=ue(t);return r?e.filter((e=>{var t,s;return(null===(t=e.PoolName)||void 0===t?void 0:t.toLowerCase().includes(r))||(null===(s=e.GroupId)||void 0===s?void 0:s.toString().includes(r))})):e},he=(e,t)=>Array.isArray(t)&&0!==t.length?e.filter((e=>{const r=e.Usage;return t.some((e=>Number(e)<=r&&r<Number(e)+5))})):e;var pe=r(33058),ge=r(6787),ve=r(32916);const fe=(0,l.withDefault)({encode:l.ArrayParam.encode,decode:e=>null===e||void 0===e?e:Array.isArray(e)?e.filter(Boolean):e?[e]:[]},[]),be=e=>{var t;let{additionalNodesProps:r,database:a,nodeId:o}=e;const d=(0,L.rU)(),p=(0,L.tS)(),[g]=(0,n.Rj)(),[v,f]=(0,l.useQueryParams)({type:l.StringParam,visible:l.StringParam,search:l.StringParam,uptimeFilter:l.StringParam,usageFilter:fe}),w=c.parse(v.type),x=u.parse(v.visible),N=null!==(t=v.search)&&void 0!==t?t:"",j=m.U8.parse(v.uptimeFilter),y=v.usageFilter,[C,S]=h.useState({sortOrder:void 0,sortValue:void 0}),O=C.sortValue?C:E.TP,[U,I]=h.useState({sortOrder:void 0,sortValue:void 0}),A=U.sortOrder?U:(0,E._r)(x),F=pe.y.useGetStorageNodesInfoQuery({database:a,visibleEntities:x,node_id:o},{skip:w!==i.d.nodes,pollingInterval:g}),G=pe.y.useGetStorageGroupsInfoQuery({database:a,with:x,nodeId:o,shouldUseGroupsHandler:p},{skip:w!==i.d.groups||!d,pollingInterval:g}),{currentData:k,isFetching:_,error:D}=w===i.d.nodes?F:G,{currentData:{nodes:T=[]}={}}=F,{currentData:{groups:M=[]}={}}=G,{nodes:z,groups:Z,...V}=null!==k&&void 0!==k?k:{found:0,total:0},W=void 0===k&&_,$=h.useMemo((()=>function(e,t,r){let s=e||[];return s=ce(s,t),s=(0,de.f)(s,r),s}(T,N,j)),[N,T,j]),K=h.useMemo((()=>function(e,t,r){let s=e||[];return s=me(s,t),s=he(s,r),s}(M,N,y)),[N,M,y]),H=h.useMemo((()=>function(e){const t={};return null===e||void 0===e||e.forEach((e=>{const r=(0,ie.I)(e,5);Object.prototype.hasOwnProperty.call(t,r)||(t[r]=0),t[r]+=1})),Object.entries(t).map((e=>{let[t,r]=e;return{threshold:Number(t),count:r}})).sort(((e,t)=>t.threshold-e.threshold))}(M)),[M]),[Q,Y]=(0,n.sC)(O,(e=>S(e))),[J,q]=(0,n.sC)(A,(e=>I(e))),B=e=>{f({usageFilter:e.length?e:void 0},"replaceIn")},X=e=>{f({search:e||void 0},"replaceIn")},ee=e=>{f({visible:e},"replaceIn")},te=e=>{f({type:e},"replaceIn")},re=e=>{f({uptimeFilter:e},"replaceIn")},se=()=>{ee(i.G.all),re(m.Uu.All)};return(0,le.u)(D)?(0,b.jsx)(ne.J,{position:"left"}):(0,b.jsxs)(oe.l,{children:[(0,b.jsx)(oe.l.Controls,{children:(0,b.jsx)(R,{searchValue:N,handleSearchValueChange:X,withTypeSelector:!0,storageType:w,handleStorageTypeChange:te,visibleEntities:x,handleVisibleEntitiesChange:ee,nodesUptimeFilter:j,handleNodesUptimeFilterChange:re,groupsUsageFilter:y,groupsUsageFilterOptions:H,handleGroupsUsageFilterChange:B,entitiesCountCurrent:w===i.d.groups?K.length:$.length,entitiesCountTotal:V.total,entitiesLoading:W})}),D?(0,b.jsx)(ae.V,{error:D}):null,(0,b.jsx)(oe.l.Table,{loading:W||!d,className:P("table"),children:k?(0,b.jsxs)(h.Fragment,{children:[w===i.d.groups&&(0,b.jsx)(ge.n,{visibleEntities:x,data:K,tableSettings:s.LE,onShowAll:()=>ee(i.G.all),sort:J,handleSort:q},"groups"),w===i.d.nodes&&(0,b.jsx)(ve.k,{visibleEntities:x,nodesUptimeFilter:j,data:$,tableSettings:s.LE,onShowAll:se,additionalNodesProps:r,sort:Q,handleSort:Y,database:a},"nodes")]}):null})]})},we=e=>{let{parentContainer:t,...r}=e;const[l]=(0,n.yu)(s.Qy);return l?(0,b.jsx)(se,{parentContainer:t,...r}):(0,b.jsx)(be,{...r})}},14223:(e,t,r)=>{r.d(t,{A:()=>m,f:()=>u});var s=r(75850),n=r(52317),l=r(34301),a=r(27070),o=r(51688),i=r(80839);const d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(arguments.length>1?arguments[1]:void 0)===i.pu.ALL?e:e.filter((e=>{let{SystemState:t}=e;return t&&t!==s.K.Green}))},u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(arguments.length>1?arguments[1]:void 0)===o.Uu.All?e:e.filter((e=>{let{StartTime:t}=e;return!t||(0,l.OW)(t)<n.RQ}))},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(!t)return e;const r=(0,a.Y)(t);return e.filter((e=>!e.Host||(r.test(e.Host)||r.test(String(e.NodeId)))))};function m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{uptimeFilter:t,searchValue:r,problemFilter:s}=arguments.length>1?arguments[1]:void 0,n=u(e,t);return n=d(n,s),n=c(n,r),n}},83496:(e,t,r)=>{r.d(t,{FW:()=>a,KR:()=>o});var s=r(75850),n=r(28164);const l={[n.g.Dead]:s.K.Red,[n.g.Created]:s.K.Yellow,[n.g.ResolveStateStorage]:s.K.Yellow,[n.g.Candidate]:s.K.Yellow,[n.g.BlockBlobStorage]:s.K.Yellow,[n.g.WriteZeroEntry]:s.K.Yellow,[n.g.Restored]:s.K.Yellow,[n.g.Discover]:s.K.Yellow,[n.g.Lock]:s.K.Yellow,[n.g.Stopped]:s.K.Yellow,[n.g.ResolveLeader]:s.K.Yellow,[n.g.RebuildGraph]:s.K.Yellow,[n.g.Deleted]:s.K.Green,[n.g.Active]:s.K.Green},a=(Object.keys(n.g),Object.entries(l).reduce(((e,t)=>{let[r,s]=t;return e[s]?e[s].push(r):e[s]=[r],e}),{}),e=>{if(!e)return s.K.Grey;return t=e,Object.values(s.K).includes(t)?e:l[e];var t});function o(e){if(!e)return"unknown";switch(e){case n.g.Dead:return"danger";case n.g.Active:case n.g.Deleted:return"success";default:return"warning"}}}}]);